# simple-http-server
Simple http server handle request with following rule:
* Response with header from all request headers
* Response with header VERSION get environment variable from OS
* Logging request ip and response code to stdout

## Getting Started
### install from source
```
# default $ARCH=amd64
$ make build ARCH=arm64
```

### build image and run with container
```
$ make docker
```

### run with docker
```
$ docker run -d -p 8080:8080 --name simple-http-server simple-http-server:latest
$ docker logs -f simple-http-server
```

### pull from dockerhub and run
```
$ docker run -d -P miles0wu/simple-http-server
```

## Image repository
* [miles0wu/simple-http-server](https://hub.docker.com/r/miles0wu/simple-http-server)

## Usage
```
NAME:
   simple-http-server - simple-http-server implement simple response from request

USAGE:
   simple-http-server [global options] command [command options] [arguments...]

COMMANDS:
   help, h  Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --port value, -p value  HTTP port (default: 8080) [$PORT]
   --help, -h              show help (default: false)
   --version, -v           print the version (default: false)
```

### APIs
#### HealthCheck
```
GET /healthz
200 OK

ok
```

#### Metrics
Provide execution latency seconds metrics
```
GET /metrics
200 OK

...metrics...
```

### Example
```
$ curl -i -H "test:123" 127.0.0.1:8080/hello
HTTP/1.1 200 OK
Accept: */*
Test: 123
User-Agent: curl/7.64.1
Version: 1.0.0
Date: Sat, 09 Oct 2021 17:09:57 GMT
Content-Length: 0

$ docker logs -f simple-http-server
2021/12/12 13:06:33 {"URI":"/hello","IP":"127.0.0.1","Code":200}
2021/12/12 13:06:33 Respond in 1115 ms
```

### Deploy and ingress on kubernetes
* [deploy.md](k8s-yaml/ingress/README.md)

### Configure prometheus and grafana
* [monitor.md](k8s-yaml/monitor/README.md)